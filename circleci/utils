#!/bin/bash

# Common functions used by more than on ci-script
#
# Usage:
#
#   . ./utils

set -e

install_awscli(){
  if type aws > /dev/null; then
    echo "AWS cli already installed"
    return
  fi

  echo "Installing AWS cli..."
  curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "/tmp/awscliv2.zip"
  unzip -q /tmp/awscliv2.zip -d /tmp
  sudo /tmp/aws/install
  echo "Completed AWS cli install"
}

install_yq(){
  if type yq > /dev/null; then
    echo "yq already installed"
    return
  fi

  echo "Installing yq..."
  mkdir -p "/tmp/bin"
  wget -O "/tmp/bin/yq" "https://github.com/mikefarah/yq/releases/download/v4.27.5/yq_linux_amd64"
  chmod +x "/tmp/bin/yq"
  export PATH="/tmp/bin:$PATH"
  echo "Completed yq install"
}

install_breakdowncli(){
  if type breakdowncli > /dev/null; then
    echo "breakdowncli already installed"
    return
  fi

  echo "Installing breakdowncli..."
  mkdir -p "/tmp/bin"
  wget -O "/tmp/bin/breakdowncli" "https://github.com/Clever/breakdown/releases/download/breakdowncli%2Fv0.1.3/breakdowncli-v0.1.3-linux-amd64"
  chmod +x "/tmp/bin/breakdowncli"
  export PATH="/tmp/bin:$PATH"
  echo "Completed breakdowncli install"
}
